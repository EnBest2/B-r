<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bérkövető – Kétműszakos nettó kalkulátor</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon.png" />
  <meta name="theme-color" content="#0b84f3" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Bérkövető" />
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Inter, sans-serif;
      background: #0a0a0a;
      color: #f6f6f6;
      padding: 16px;
    }
    h1 {
      font-size: 22px;
      margin-bottom: 12px;
    }
    label {
      display: block;
      margin-bottom: 12px;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      border-radius: 8px;
      border: 1px solid #333;
      background: #141414;
      color: #fff;
      font-size: 16px;
    }
    button {
      padding: 10px 16px;
      border-radius: 8px;
      border: none;
      background: #0b84f3;
      color: white;
      font-size: 16px;
      margin-top: 12px;
      cursor: pointer;
    }
    .section {
      margin-bottom: 24px;
    }
    .day-entry {
      border: 1px solid #222;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 8px;
      background: #141414;
    }
    .summary {
      font-size: 18px;
      margin-top: 12px;
      color: #2ecc71;
    }
  </style>
</head>
<body>
  <h1>Bérkövető – Kétműszakos nettó kalkulátor</h1>

  <div class="section">
    <label>
      Hónap kiválasztása:
      <input type="month" id="monthPicker" />
    </label>

    <label>
      Melyik héttel indul a hónap?
      <select id="startWeek">
        <option value="morning">Délelőttös</option>
        <option value="afternoon">Délutános</option>
      </select>
    </label>

    <button onclick="generateMonth()">Hónap generálása</button>
  </div>

  <div class="section">
    <label>
      Nettó órabér (Ft):
      <input type="number" id="netHourly" />
    </label>

    <label>
      Délutáni pótlék (% csak 18:00–21:30 között):
      <input type="number" id="allowancePct" value="30" />
    </label>

    <label>
      Túlóra szorzó (alap: 1.8):
      <input type="number" id="overtimeMultiplier" value="1.8" step="0.1" />
    </label>

    <label>
      <input type="checkbox" id="szjaFree" />
      SZJA-mentes vagyok (ne vonjon 15% SZJA-t)
    </label>
  </div>

  <div class="section">
    <h2>Napok</h2>
    <div id="days"></div>
  </div>

  <div class="section summary" id="summary">Havi nettó összesen: 0 Ft</div>

  <script>
    const daysDiv = document.getElementById("days");
    const summaryDiv = document.getElementById("summary");

    function generateMonth() {
      const monthStr = document.getElementById("monthPicker").value;
      const startWeek = document.getElementById("startWeek").value;
      if (!monthStr) return;

      daysDiv.innerHTML = "";
      const [year, month] = monthStr.split("-").map(Number);
      const date = new Date(year, month - 1, 1);
      let isMorningWeek = startWeek === "morning";

      while (date.getMonth() === month - 1) {
        const day = date.getDate();
        const weekday = date.getDay(); // 0 = Sunday
        const label = `${year}-${String(month).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
        const isWeekend = weekday === 0 || weekday === 6;

        const entry = document.createElement("div");
        entry.className = "day-entry";
        entry.innerHTML = `
          <strong>${label}</strong><br/>
          <label>
            Műszak típusa:
            <select class="shift">
              <option value="none">Nincs</option>
              <option value="morning">Délelőtt</option>
              <option value="afternoon">Délután</option>
            </select>
          </label>
          <label>
            Műszak vége (óra:perc):
            <input type="time" class="endTime" value="${isMorningWeek ? "13:30" : "21:30"}" />
          </label>
        `;
        daysDiv.appendChild(entry);

        if (weekday === 5) isMorningWeek = !isMorningWeek; // váltás szombaton
        date.setDate(day + 1);
      }

      calculateTotal();
    }

    function calculateTotal() {
      const netHourly = parseFloat(document.getElementById("netHourly").value) || 0;
      const allowancePct = parseFloat(document.getElementById("allowancePct").value) || 0;
      const overtimeMultiplier = parseFloat(document.getElementById("overtimeMultiplier").value) || 1;
      const szjaFree = document.getElementById("szjaFree").checked;

      let totalNet = 0;

      document.querySelectorAll(".day-entry").forEach(entry => {
        const shift = entry.querySelector(".shift").value;
        const endTime = entry.querySelector(".endTime").value;
        if (shift === "none") return;

        let baseMinutes = shift === "morning" ? 480 : 480;
        let endMinutes = timeToMinutes(endTime);
        let startMinutes = shift === "morning" ? timeToMinutes("05:30") : timeToMinutes("13:30");
        let workedMinutes = Math.max(0, endMinutes - startMinutes);
        let overtimeMinutes = Math.max(0, workedMinutes - baseMinutes);

        let baseNet = (baseMinutes / 60) * netHourly;
        let overtimeNet = (overtimeMinutes / 60) * netHourly * overtimeMultiplier;

        let allowanceMinutes = 0;
        if (shift === "afternoon") {
          const allowanceStart = timeToMinutes("18:00");
          const allowanceEnd = timeToMinutes("21:30");
          allowanceMinutes = Math.max(0, Math.min(endMinutes, allowanceEnd) - Math.max(startMinutes, allowanceStart));
        }
        let allowanceNet = (allowanceMinutes / 60) * netHourly * (allowancePct / 100);

        let dayNet = baseNet + overtimeNet + allowanceNet;
        if (!szjaFree) dayNet *= 0.85;

        totalNet += dayNet;
      });

      summaryDiv.textContent = `Havi nettó összesen: ${Math.round(totalNet).toLocaleString("hu-HU")} Ft`;
    }

    function timeToMinutes(t) {
      const [h, m] = t.split(":").map(Number);
      return h * 60 + m;
    }

    document.getElementById("netHourly").addEventListener("input", calculateTotal);
    document.getElementById("allowancePct").addEventListener("input", calculateTotal);
    document.getElementById("overtimeMultiplier").addEventListener("input", calculateTotal);
    document.getElementById("szjaFree").addEventListener("change", calculateTotal);
    daysDiv.addEventListener("input", calculateTotal);
  </script>
</body>
</html>
